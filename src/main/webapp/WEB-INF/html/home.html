<!DOCTYPE html>
<html>
<head>

<link href="../static/css/bootstrap.css" rel="stylesheet">
<link href="../static/css/main.css" rel="stylesheet">
</head>
<body>

<div id='container' class='container navbar navbar-default'>
	<div class='row'>
		<a href='home.html' class='nav navbar-brand'>ForumApp</a>
		<ul class='list-unstyled list-inline nav navbar-nav navbar-right'>
			<li><a class='nav navbar-nav navbar-brand' href='home.html'>Home</a></li>
		</ul>
	</div>
	
	<div class='row well well-lg'>
		<div class='row right'>
			<input type='button' value='Create Topic' name='createTopic' id='createTopic' class='btn btn-primary btn-md pull-right'></input>
		</div>
		</br>
		<div id="topicList">
		</div>
		<div id="userIdDiv">
			<input type='hidden' id='userName' name='userName' value='swapnil'></input>
			<input type='hidden' id='userId' name='userId' value='6'></input>
			<input type='hidden' id='emailId' name='emailId' value='swapnil.solanki@townscript.com'></input>
		</div>
	</div>
	
</div>

<script src="../static/js/jquery.1.10.2.min.js"></script>
<script src="../static/js/bootstrap.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		getAllTopics();
	});
	
	$('#createTopic').click(function(event) {
		//window.location.href="http://localhost:8080/forum-api/topic/createTopic";
		window.location.href="topic-create.html";
	});
	
	//to get all topics on home page
	function getAllTopics() {
		var topicsUrl = "http://localhost:8080/forum-api/topic/getAllTopics";
		
		var jsonData={ 	"status" : "success",
						"topicList" : [
						              	{
						            	   	"id":"1",
											"title":"pune marathon in july 2017",
											"description":"this topic is based on the the marathod happened in pune in july 2017. want to know reviews on the same.",
											"createdAt":"2017-07-23 16:11:10",
											"createdBy":"Swapnil Solanki",
											"voteCount":"10",
											"isVoted":"Y",
											"voteValue":"1",
											"tags":"sports",
											"topicUrl":"testTopic1",
											"topicId":"1",
											"commentList" :[
															{
																"id":"1",
																"type":"T",
																"value":"awesome marathon",
																"createdAt":"2017-07-24 16:11:10",
																"createdBy":"punjabi"
																//"topicId":"1"
															},
															{
																"id":"3",
																"type":"T",
																"value":"loved it!",
																"createdAt":"2017-07-25 12:11:10",
																"createdBy":"Ankit"
																//"topicId":"1"
															}
															]
										} ,
										{
						            	   	"id":"2",
											"title":"TEDx event in Mumbai",
											"description":"i want to know more details about TEDx event happened in mumbai in April 2017",
											"createdAt":"2017-07-21 16:11:10",
											"createdBy":"Himanshu Singh",
											"voteCount":"20",
											"isVoted":"Y",
											"voteValue":"2",
											"tags":"general",
											"topicUrl":"testTopic2",
											"topicId":"2",
											"commentList" :[
															{
																"id":"2",
																"type":"T",
																"value":"it is nice one!",
																"createdAt":"2017-07-22 16:11:10",
																"createdBy":"balaji"
																//"topicId":"2"
																}
															]
										},
										{
						            	   	"id":"3",
											"title":"IEEE event at IISc bangalore",
											"description":"how was the IEEE event happened at IISc bangalore June 2017?",
											"createdAt":"2017-07-11 16:11:10",
											"createdBy":"Sushant Pawar",
											"voteCount":"15",
											"isVoted":"N",
											"voteValue":"0",
											"tags":"technical",
											"topicUrl":"testTopic3",
											"topicId":"3",
											"commentList" :[
															{
																"id":"4",
																"type":"T",
																"value":"really good one!",
																"createdAt":"2017-07-22 16:11:10",
																"createdBy":"Aakash"
																//"topicId":"3"
																}
															]
										}
						               ]
						};
					
		
		if(jsonData.status=="success") {
			var data = jsonData.topicList;
			
			var topicListSize = data.length;
			for (var i = 0; i < topicListSize; i++) {
				var id;
				var title;
				var description;
				var createdAt;
				var createdBy;
				var voteCount;
				var tags;
				var topicUrl;
				var topicId;
				var commentList=[];
				
				var j = 0;
				var topics = [];
				var topicI="topic-"+i;
				topics.push("<div id='"+topicI+"' class='row well well-lg'>");
				$.each( data[i] , function( key, val ) {
					if(key.toString()=="id"){
						id=val;
					} else if(key.toString()=="title"){
						title=val;
					} else if(key.toString()=="description"){
						description=val;
					} else if(key.toString()=="createdAt"){
						createdAt=val;
					} else if(key.toString()=="createdBy"){
						createdBy=val;
					} else if(key.toString()=="voteCount"){
						voteCount=val;
					} else if(key.toString()=="tags"){
						tags=val;
					} else if(key.toString()=="topicUrl"){
						topicUrl=val;
					} else if(key.toString()=="commentList"){
						commentList=val;
					} else if(key.toString()=="topicId"){
						topicId=val;
					}
					j++;
				});
				
				/* var myDate = new Date('2011-07-14 11:23:00');
				alert("full-year: "+myDate.getFullYear())
				alert("day: "+myDate.getDay())
				alert("date: "+myDate.getDate()) */
				
				topics.push( "<label class='row well strong lead col-md-12 large bg-faded text-primary' id='title'>" + title + "</label>" );
				topics.push( "</br><label class='row well col-md-12 medium bg-faded' id='description'><label class='small text-info'>Description:</label> </br> " + description + "</label>" );
				topics.push( "</br><button class='btn btn-xs' id='upvote-btn' name='upvote-btn'><img class='upvote-img' id='upvote'></img></button>" );
				topics.push( "&nbsp&nbsp<button class='btn btn-xs' id='downvote-btn' name='downvote-btn'><img class='downvote-img' id='downvote'></img></button>" );
				topics.push( "</br><label class='small text-warning' id='voteCount'>"+ voteCount + " Votes </label>" );
				topics.push( "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<label class='small' id='createdBy'> <label class='text-muted'>Created By: </label> "+ createdBy + "</label>" );
				topics.push( "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<label class='small' id='createdAt'> <label class='text-muted'>Created At: </label> "+ createdAt + "</label>" );
				
				var commentListVar="commentList-"+i;
				topics.push( "<div id='"+commentListVar+"'>" );   //start commentList logic
				topics.push("</div>");
				$(topics.join( "" )).appendTo( "#topicList" );
				
				var commentListSize = commentList.length;
				for (var l = 0; l < commentListSize; l++) {
					var commentId;
					var commentType;
					var commentValue;
					var commentCreatedAt;
					var commentCreatedBy;
					var comments = [];
					var k=0;
					$.each( commentList[l] , function( key, val ) {
						if(key.toString()=="id"){
							commentId=val;
						} else if(key.toString()=="type"){
							commentType=val;
						} else if(key.toString()=="value"){
							commentValue=val;
						} else if(key.toString()=="createdAt"){
							commentCreatedAt=val;
						} else if(key.toString()=="createdBy"){
							commentCreatedBy=val;
						}
						k++;
					});
					
					//for existing comments
					comments.push( "<div class='row well'>");
						comments.push( "<label class='col-md-offset-0 col-md-1 small' id='commentCreatedBy'>" + commentCreatedBy + "</label>");
						comments.push( "&nbsp&nbsp&nbsp&nbsp<input class='small col-md-7' readonly='true' id='commentValue' value='"+ commentValue + "'></input>" );
					comments.push( "</div>");
					
					$(comments.join( "" )).appendTo( "#"+commentListVar);
				}
				
				//for new comment
				var newCommentFieldId="add-comment-"+topicI+"-comment-"+commentListSize;
				var userName = document.getElementById('userName').value;
				var newComment=[];
				newComment.push( "<div class='row well'>");
					newComment.push( "<label class='col-md-offset-0 col-md-1 small' id='newCommentCreatedBy'>" + userName + "</label>");
					var onClickFunc="newComment('field','12','swapnil')";
					newComment.push( "<input type='text' class='small col-md-7' id='"+newCommentFieldId+"' name='"+newCommentFieldId+"' placeholder='add new comment'></input>");
				 	newComment.push( "&nbsp&nbsp&nbsp&nbsp<input type='button' value='Add' name='addComment' id='addComment' class='btn btn-info btn-xs' onclick='addNewComment('"+newCommentFieldId+"','"+topicId+"','swapnil')'></input>");
				 	//newComment.push( "<input type='button' value='Add Comment' name='newComment' id='newComment' class='btn btn-info btn-sm pull-right' onclick='"+onClickFunc+"'></input>");
				 	//newComment.push( "<input type='button' value='Add' name='addComment' id='addComment' class='btn btn-info btn-md pull-right' onclick='addNewComment()'></input>");
				newComment.push( "</div>");
				
				$(newComment.join( "" )).appendTo( "#"+commentListVar);
				
			}
			//});
			
		}
	}
	
</script>

<script type="text/javascript">
	function newComment(commentFieldId, topicId, userName) {
		/* alert("commentFieldId: "+commentFieldId);
		alert("topicId: "+topicId);
		alert("userId: "+userId); */
		var commentValue = document.getElementById(commentFieldId).value;
		var newCommentURL = "http://localhost:8080/forum-api/comment/newComment";
		
		$.ajax({
			type: "POST",
			url: newCommentURL,
			dataType: "json",
			data : {
				topicId : topicId,
				userName : userId,
				commentValue : commentValue
			},
			success: function(data) {
				//alert(data);
				//if(data.status == "success"){
				if(data != null){
					location.reload();
				}else{
				    alert("Some error, please try again!");
				}
			}
		});
	}
</script>

</body>
</html>