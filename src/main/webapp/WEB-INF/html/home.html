<!DOCTYPE html>
<html lang='en'>
<head>

<link href="../static/css/bootstrap.css" rel="stylesheet">
<link href="../static/css/main.css" rel="stylesheet">
</head>
<body>

<div id='container' class='container navbar navbar-default'>
	<div class='row'>
		<a href='home.html' class='nav navbar-brand'>ForumApp</a>
		<ul class='list-unstyled list-inline nav navbar-nav navbar-right'>
			<li><a class='nav navbar-nav navbar-brand' href='home.html'>Home</a></li>
		</ul>
	</div>
	
	<div class='row well well-lg'>
		<div class='row right'>
			<input type='button' value='Create Topic' name='createTopic' id='createTopic' class='btn btn-primary btn-md pull-right'></input>
		</div>
		</br>
		<div id="topicList">
			<!-- <div id="commentList">
			</div> -->
		</div>
	</div>
	
</div>

<script src="../static/js/jquery.1.10.2.min.js"></script>
<script src="../static/js/bootstrap.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		getAllTopics();
	});
	
	$('#createTopic').click(function(event) {
		//window.location.href="http://localhost:8080/forum-api/topic/createTopic";
		window.location.href="topic-create.html";
	});
	
	//to get all topics on home page
	function getAllTopics() {
		var topicsUrl = "http://localhost:8080/forum-api/topic/getAllTopics";
		
		var jsonData={ 	"status" : "success",
						"topicList" : [
						              	{
						            	   	"id":"1",
											"title":"pune marathon last month",
											"description":"sample topic",
											"createdAt":"2017-07-23 16:11:10",
											"createdBy":"Swapnil Solanki",
											"voteCount":"10",
											"tags":"sports",
											"topicUrl":"testTopic1",
											"topicId":"1",
											"commentList" :[
															{
																"id":"1",
																"type":"T",
																"value":"awesome marathon",
																"createdAt":"2017-07-24 16:11:10",
																"createdBy":"punjabi"
																//"topicId":"1"
															},
															{
																"id":"3",
																"type":"T",
																"value":"loved it!",
																"createdAt":"2017-07-25 12:11:10",
																"createdBy":"Ankit"
																//"topicId":"1"
															}
															]
										} ,
										{
						            	   	"id":"2",
											"title":"TEDx event in Mumbai",
											"description":"sample topic2",
											"createdAt":"2017-07-21 16:11:10",
											"createdBy":"Himanshu Singh",
											"voteCount":"20",
											"tags":"general",
											"topicUrl":"testTopic2",
											"topicId":"2",
											"commentList" :[
															{
																"id":"2",
																"type":"T",
																"value":"it is nice one!",
																"createdAt":"2017-07-22 16:11:10",
																"createdBy":"balaji"
																//"topicId":"2"
																}
															]
										},
										{
						            	   	"id":"3",
											"title":"IEEE event at IISc bangalore",
											"description":"sample topic3",
											"createdAt":"2017-07-11 16:11:10",
											"createdBy":"Sushant Pawar",
											"voteCount":"15",
											"tags":"technical",
											"topicUrl":"testTopic3",
											"topicId":"3",
											"commentList" :[
															{
																"id":"4",
																"type":"T",
																"value":"really good one!",
																"createdAt":"2017-07-22 16:11:10",
																"createdBy":"Aakash"
																//"topicId":"3"
																}
															]
										}
						               ]
						};
					
		
		if(jsonData.status=="success") {
			var data = jsonData.topicList;
			for (var i = 0; i < data.length; i++) {
				var id;
				var title;
				var description;
				var createdAt;
				var createdBy;
				var voteCount;
				var tags;
				var topicUrl;
				var topicId;
				var commentList=[];
				
				var j = 0;
				var topics = [];
				var topicI="topic-"+i;
				topics.push("<div id='"+topicI+"' class='row well well-lg'>");
				$.each( data[i] , function( key, val ) {
					if(key.toString()=="id"){
						id=val;
					} else if(key.toString()=="title"){
						title=val;
					} else if(key.toString()=="description"){
						description=val;
					} else if(key.toString()=="createdAt"){
						createdAt=val;
					} else if(key.toString()=="createdBy"){
						createdBy=val;
					} else if(key.toString()=="voteCount"){
						voteCount=val;
					} else if(key.toString()=="tags"){
						tags=val;
					} else if(key.toString()=="topicUrl"){
						topicUrl=val;
					} else if(key.toString()=="commentList"){
						commentList=val;
					} else if(key.toString()=="topicId"){
						topicId=val;
					}
					j++;
				});
				
				topics.push( "<label class='row well strong lead col-md-12 large bg-faded text-primary' id='title'>" + title + "</label>" );
				topics.push( "</br><label class='small text-warning' id='voteCount'>"+ voteCount + " Votes </label>" );
				topics.push( "&nbsp&nbsp&nbsp&nbsp<label class='small text-info' id='createdBy'> Created By: "+ createdBy + "</label>" );
				topics.push( "&nbsp&nbsp&nbsp&nbsp<label class='small' id='createdAt'> Created At: "+ createdAt + "</label>" );
				
				
				var commentListVar="commentList"+i;
				topics.push( "<div id='"+commentListVar+"'>" );   //start commentList logic
				//topics.push( "<div id='commentList'>" );   //start commentList logic
				//topics.push( "</div>" );
				
				topics.push("</div>");
				$(topics.join( "" )).appendTo( "#topicList" );
				
				for (var l = 0; l < commentList.length; l++) {
					var commentId;
					var commentType;
					var commentValue;
					var commentCreatedAt;
					var commentCreatedBy;
					var comments = [];
					var k=0;
					//alert("comments length: "+commentList.length);
					$.each( commentList[l] , function( key, val ) {
						//alert("key: "+key +" ,value: "+val);
						if(key.toString()=="id"){
							commentId=val;
						} else if(key.toString()=="type"){
							commentType=val;
						} else if(key.toString()=="value"){
							commentValue=val;
						} else if(key.toString()=="createdAt"){
							commentCreatedAt=val;
						} else if(key.toString()=="createdBy"){
							commentCreatedBy=val;
						}
						k++;
					});
					
					//for existing comments
					comments.push( "<div class='row well'>");
						comments.push( "<label class='col-md-offset-1 col-md-1 small' id='commentCreatedBy'>" + commentCreatedBy + "</label>");
						comments.push( "&nbsp&nbsp&nbsp&nbsp<input class='small col-md-6' readonly='true' id='commentValue' value='"+ commentValue + "'></input>" );
					comments.push( "</div>");
					
					//for new comment
					/*  comments.push( "<div class='row well'>");
						comments.push( "<input type='text' class='col-md-offset-2 small col-md-6' id='newComment' name='newComment' placeholder='add new comment'></input>");
						comments.push( "<input type='button' value='Add' name='addComment' id='addComment' class='btn btn-info btn-md pull-right'></input>");
					comments.push( "</div>"); */
					
					//$(comments.join( "" )).appendTo( "#commentList" );
					
				//}
					//comments.push("</div>");   //end commentList logic
					
					//alert("topic: "+i+" ,comments: "+comments);
					//var commentListVar="commentList"+i;
					//alert("commentListVar: "+commentListVar);
					$(comments.join( "" )).appendTo( "#"+commentListVar);
					//$(comments.join( "" )).appendTo( "#commentList" );
				}
				var newComment=[];
				//for new comment
				 newComment.push( "<div class='row well'>");
				 	newComment.push( "<input type='text' class='col-md-offset-2 small col-md-6' id='newComment' name='newComment' placeholder='add new comment'></input>");
				 	newComment.push( "<input type='button' value='Add' name='addComment' id='addComment' class='btn btn-info btn-md pull-right'></input>");
				 newComment.push( "</div>");
				$(newComment.join( "" )).appendTo( "#"+commentListVar);
				
				//topics.push("</div>");
				//$(topics.join( "" )).appendTo( "#topicList" );
			}
			//});
			
		}
		
		/* $.ajax({
			type: "GET",
			url: topicsUrl,
			dataType: "json",
			success: function(data) {
				//alert(data);
				if(data.status == "success"){
					
				}else{
				    alert("Some error in loading, please try again!");
				}
			}
		}); */
	}
</script>

</body>
</html>